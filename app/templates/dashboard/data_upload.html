{% extends 'base.html' %}
{% load static %}

{% block title %}Data Upload - EcoGenomics Suite{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="etfash-logo">
                        <img src="{% static 'images/etfash-logo.jpeg' %}" alt="ETfash Logo" class="w-full h-full rounded-lg">
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold brand-text">EcoGenomics Suite</h1>
                        <p class="text-sm text-gray-600">Environmental Data Upload</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">Welcome, {{ user.username }}</span>
                    <a href="{% url 'dashboard' %}" class="text-emerald-600 hover:text-emerald-700 text-sm font-medium">Dashboard</a>
                    <a href="{% url 'logout' %}" class="text-gray-600 hover:text-gray-700 text-sm">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="flex mb-8" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="{% url 'dashboard' %}" class="text-gray-700 hover:text-emerald-600 inline-flex items-center">
                        <i class="fas fa-home w-4 h-4 mr-2"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 w-4 h-4"></i>
                        <span class="ml-1 text-gray-500 md:ml-2">Data Upload</span>
                    </div>
                </li>
            </ol>
        </nav>

        <!-- Messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="mb-6 p-4 rounded-md {% if message.tags == 'error' %}bg-red-50 border border-red-200{% elif message.tags == 'success' %}bg-green-50 border border-green-200{% else %}bg-blue-50 border border-blue-200{% endif %}">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            {% if message.tags == 'error' %}
                                <i class="fas fa-exclamation-circle text-red-400"></i>
                            {% elif message.tags == 'success' %}
                                <i class="fas fa-check-circle text-green-400"></i>
                            {% else %}
                                <i class="fas fa-info-circle text-blue-400"></i>
                            {% endif %}
                        </div>
                        <div class="ml-3">
                            <p class="{% if message.tags == 'error' %}text-red-800{% elif message.tags == 'success' %}text-green-800{% else %}text-blue-800{% endif %} text-sm">{{ message }}</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endif %}

        <!-- Upload Form -->
        <div class="bg-white shadow-lg rounded-lg overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-emerald-500 to-cyan-500">
                <h2 class="text-xl font-semibold text-white flex items-center">
                    <i class="fas fa-upload mr-3"></i>
                    Upload Environmental Data
                </h2>
                <p class="text-emerald-100 text-sm mt-1">Upload Excel or CSV files containing environmental measurements</p>
            </div>

            <form method="post" enctype="multipart/form-data" class="p-6 space-y-6">
                {% csrf_token %}
                
                <!-- File Upload Section -->
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-emerald-400 transition-colors">
                    <div class="space-y-4">
                        <div class="mx-auto w-12 h-12 text-gray-400">
                            <i class="fas fa-file-upload text-4xl"></i>
                        </div>
                        <div>
                            <label for="{{ form.data_file.id_for_label }}" class="cursor-pointer">
                                <span class="text-lg font-medium text-gray-900">Choose file to upload</span>
                                <p class="text-sm text-gray-500 mt-1">Excel (.xlsx, .xls) or CSV (.csv) files up to 10MB</p>
                            </label>
                            {{ form.data_file }}
                        </div>
                        {% if form.data_file.errors %}
                            <div class="text-red-600 text-sm">
                                {% for error in form.data_file.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Batch Information -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="{{ form.batch_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            Batch Name <span class="text-red-500">*</span>
                        </label>
                        {{ form.batch_name }}
                        {% if form.batch_name.errors %}
                            <div class="text-red-600 text-sm mt-1">
                                {% for error in form.batch_name.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">{{ form.batch_name.help_text }}</p>
                    </div>

                    <div>
                        <label for="{{ form.sampling_date.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            Sampling Date <span class="text-red-500">*</span>
                        </label>
                        {{ form.sampling_date }}
                        {% if form.sampling_date.errors %}
                            <div class="text-red-600 text-sm mt-1">
                                {% for error in form.sampling_date.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">{{ form.sampling_date.help_text }}</p>
                    </div>
                </div>

                <div>
                    <label for="{{ form.batch_description.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                        Description
                    </label>
                    {{ form.batch_description }}
                    {% if form.batch_description.errors %}
                        <div class="text-red-600 text-sm mt-1">
                            {% for error in form.batch_description.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Project Information -->
                <div class="border-t pt-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Project Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="{{ form.project_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Project Name
                            </label>
                            {{ form.project_name }}
                            {% if form.project_name.errors %}
                                <div class="text-red-600 text-sm mt-1">
                                    {% for error in form.project_name.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="text-xs text-gray-500 mt-1">{{ form.project_name.help_text }}</p>
                        </div>

                        <div>
                            <label for="{{ form.project_code.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Project Code
                            </label>
                            {{ form.project_code }}
                            {% if form.project_code.errors %}
                                <div class="text-red-600 text-sm mt-1">
                                    {% for error in form.project_code.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="text-xs text-gray-500 mt-1">{{ form.project_code.help_text }}</p>
                        </div>

                        <div>
                            <label for="{{ form.study_type.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                Study Type
                            </label>
                            {{ form.study_type }}
                            {% if form.study_type.errors %}
                                <div class="text-red-600 text-sm mt-1">
                                    {% for error in form.study_type.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Processing Options -->
                <div class="border-t pt-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Processing Options</h3>
                    <div class="space-y-4">
                        <div class="flex items-center">
                            {{ form.create_missing_locations }}
                            <label for="{{ form.create_missing_locations.id_for_label }}" class="ml-2 text-sm text-gray-700">
                                {{ form.create_missing_locations.help_text }}
                            </label>
                        </div>
                        <div class="flex items-center">
                            {{ form.skip_invalid_rows }}
                            <label for="{{ form.skip_invalid_rows.id_for_label }}" class="ml-2 text-sm text-gray-700">
                                {{ form.skip_invalid_rows.help_text }}
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end space-x-4 pt-6 border-t">
                    <a href="{% url 'dashboard' %}" class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors">
                        Cancel
                    </a>
                    <button type="submit" class="px-6 py-2 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white rounded-md hover:from-emerald-600 hover:to-cyan-600 transition-colors flex items-center">
                        <i class="fas fa-upload mr-2"></i>
                        Upload & Preview
                    </button>
                </div>
            </form>
        </div>

        <!-- Help Section -->
        <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
            <h3 class="text-lg font-medium text-blue-900 mb-4 flex items-center">
                <i class="fas fa-info-circle mr-2"></i>
                File Format Requirements
            </h3>
            <div class="text-sm text-blue-800 space-y-2">
                <p><strong>Required Columns:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong>Location:</strong> Site name or identifier</li>
                    <li><strong>Pollutant:</strong> Name of the measured pollutant</li>
                    <li><strong>Concentration:</strong> Measured value</li>
                    <li><strong>Date:</strong> Sampling date and time</li>
                </ul>
                <p class="mt-4"><strong>Optional Columns:</strong></p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Latitude, Longitude (for location coordinates)</li>
                    <li>Temperature, Humidity, Pressure (environmental conditions)</li>
                    <li>Wind Speed, Wind Direction</li>
                    <li>Sampling Method, Equipment Used, Operator</li>
                    <li>Notes, Quality Flag</li>
                </ul>
            </div>
        </div>
    </main>
</div>
{% endblock %}