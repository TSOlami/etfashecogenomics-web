{% extends 'base.html' %}
{% load static %}
{% load dashboard_filters %}

{% block title %}Dashboard - EcoGenomics Suite{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="etfash-logo">
                        <img src="{% static 'images/etfash-logo.jpeg' %}" alt="ETfash Logo" class="w-full h-full rounded-lg">
                    </div>
                    <div>
                        <h1 class="text-xl font-bold brand-text">EcoGenomics Suite</h1>
                        <p class="text-xs text-gray-500">Environmental & Genomic Analytics</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">Welcome, {{ user.username }}</span>
                    <a href="{% url 'logout' %}" class="text-sm text-red-600 hover:text-red-800">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Tab Navigation -->
        <div class="border-b border-gray-200 mb-6">
            <nav class="-mb-px flex space-x-8 overflow-x-auto">
                <button onclick="showTab('overview', event)" class="tab-btn whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-emerald-500 text-emerald-600 active">
                    <i class="fas fa-tachometer-alt mr-2"></i>Overview
                </button>
                <button onclick="showTab('data-upload', event)" class="tab-btn whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    <i class="fas fa-upload mr-2"></i>Data Upload
                </button>
                <button onclick="showTab('environmental', event)" class="tab-btn whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    <i class="fas fa-leaf mr-2"></i>Environmental
                </button>
                <button onclick="showTab('bioinformatics', event)" class="tab-btn whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    <i class="fas fa-dna mr-2"></i>Genomics
                </button>
                <button onclick="showTab('analytics', event)" class="tab-btn whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    <i class="fas fa-chart-bar mr-2"></i>Analytics
                </button>
                <button onclick="showTab('reports', event)" class="tab-btn whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    <i class="fas fa-file-alt mr-2"></i>Reports
                </button>
            </nav>
        </div>

        <!-- Tab Contents -->
        
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Key Metrics Cards -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-emerald-100">
                            <i class="fas fa-thermometer-half text-emerald-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Temperature</p>
                            <p class="text-2xl font-semibold text-gray-900">{{ environmental_data.temperature.value }}{{ environmental_data.temperature.unit }}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100">
                            <i class="fas fa-dna text-blue-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Species Diversity</p>
                            <p class="text-2xl font-semibold text-gray-900">{{ genomic_data.species_diversity }}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100">
                            <i class="fas fa-flask text-purple-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">pH Level</p>
                            <p class="text-2xl font-semibold text-gray-900">{{ environmental_data.ph_level.value }}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100">
                            <i class="fas fa-vial text-yellow-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Samples</p>
                            <p class="text-2xl font-semibold text-gray-900">{{ genomic_data.total_samples }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Temperature Trend</h3>
                    <div class="chart-container">
                        <canvas id="temperatureChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Species Distribution</h3>
                    <div class="chart-container">
                        <canvas id="speciesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Upload Tab -->
        <div id="data-upload" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Upload Form -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-upload mr-2 text-emerald-600"></i>Upload Data Files
                    </h3>
                    
                    <form id="uploadForm" enctype="multipart/form-data" class="space-y-4">
                        {% csrf_token %}
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select File Type</label>
                            <select name="file_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="environmental">Environmental Data</option>
                                <option value="genomic">Genomic Samples</option>
                                <option value="biodiversity">Biodiversity Records</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Choose File</label>
                            <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-emerald-400 transition-colors">
                                <div class="space-y-1 text-center">
                                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>
                                    <div class="flex text-sm text-gray-600">
                                        <label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-emerald-600 hover:text-emerald-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-emerald-500">
                                            <span>Upload a file</span>
                                            <input id="file-upload" name="file" type="file" class="sr-only" accept=".csv,.xlsx,.xls">
                                        </label>
                                        <p class="pl-1">or drag and drop</p>
                                    </div>
                                    <p class="text-xs text-gray-500">CSV, Excel files up to 10MB</p>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="w-full eco-button py-2 px-4 rounded-md text-white font-medium">
                            <i class="fas fa-upload mr-2"></i>Upload & Process
                        </button>
                    </form>
                    
                    <!-- Upload Progress -->
                    <div id="uploadProgress" class="hidden mt-4">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div id="progressBar" class="bg-emerald-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="progressText" class="text-sm text-gray-600 mt-2">Processing...</p>
                    </div>
                </div>

                <!-- Upload History -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-history mr-2 text-blue-600"></i>Recent Uploads
                    </h3>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-file-csv text-emerald-600 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">environmental_data.csv</p>
                                    <p class="text-xs text-gray-500">2 hours ago • 1,234 records</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 text-xs font-medium bg-emerald-100 text-emerald-800 rounded-full">Completed</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-file-excel text-blue-600 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">genomic_samples.xlsx</p>
                                    <p class="text-xs text-gray-500">1 day ago • 856 records</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 text-xs font-medium bg-emerald-100 text-emerald-800 rounded-full">Completed</span>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-file-csv text-emerald-600 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">biodiversity_records.csv</p>
                                    <p class="text-xs text-gray-500">3 days ago • 2,145 records</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Processing</span>
                        </div>
                    </div>
                    
                    <button class="w-full mt-4 px-4 py-2 text-sm text-emerald-600 border border-emerald-600 rounded-md hover:bg-emerald-50 transition-colors">
                        View All Uploads
                    </button>
                </div>
            </div>

            <!-- Sample Data Templates -->
            <div class="mt-6 bg-white p-6 rounded-lg card-shadow">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-download mr-2 text-purple-600"></i>Download Sample Templates
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <a href="{% url 'download_template' 'environmental' %}" class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-emerald-300 hover:bg-emerald-50 transition-colors">
                        <i class="fas fa-leaf text-emerald-600 mr-3"></i>
                        <div>
                            <p class="font-medium text-gray-900">Environmental Template</p>
                            <p class="text-sm text-gray-500">Temperature, pH, humidity data</p>
                        </div>
                    </a>
                    
                    <a href="{% url 'download_template' 'genomic' %}" class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors">
                        <i class="fas fa-dna text-blue-600 mr-3"></i>
                        <div>
                            <p class="font-medium text-gray-900">Genomic Template</p>
                            <p class="text-sm text-gray-500">Sample ID, species, variants</p>
                        </div>
                    </a>
                    
                    <a href="{% url 'download_template' 'biodiversity' %}" class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-purple-300 hover:bg-purple-50 transition-colors">
                        <i class="fas fa-seedling text-purple-600 mr-3"></i>
                        <div>
                            <p class="font-medium text-gray-900">Biodiversity Template</p>
                            <p class="text-sm text-gray-500">Species, location, status</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Environmental Tab -->
        <div id="environmental" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Environmental Metrics -->
                {% for key, data in environmental_data.items %}
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">{{ key|format_key }}</p>
                            <p class="text-2xl font-semibold text-gray-900">{{ data.value }}{{ data.unit }}</p>
                            <p class="text-sm text-gray-500">{{ data.description }}</p>
                        </div>
                        <div class="p-3 rounded-full {% if data.status == 'optimal' or data.status == 'good' or data.status == 'normal' %}bg-emerald-100{% elif data.status == 'warning' %}bg-yellow-100{% else %}bg-red-100{% endif %}">
                            <i class="fas fa-check-circle {% if data.status == 'optimal' or data.status == 'good' or data.status == 'normal' %}text-emerald-600{% elif data.status == 'warning' %}text-yellow-600{% else %}text-red-600{% endif %}"></i>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Environmental Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Air Quality Trend</h3>
                    <div class="chart-container">
                        <canvas id="airQualityChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Environmental Analysis</h3>
                    <div class="space-y-4">
                        <button onclick="runStatisticalAnalysis('environmental')" class="w-full eco-button py-2 px-4 rounded-md text-white font-medium">
                            <i class="fas fa-calculator mr-2"></i>Run Statistical Analysis
                        </button>
                        <button onclick="generateVisualization('environmental')" class="w-full bg-blue-600 hover:bg-blue-700 py-2 px-4 rounded-md text-white font-medium">
                            <i class="fas fa-chart-line mr-2"></i>Generate Visualizations
                        </button>
                        <button onclick="exportData('environmental')" class="w-full bg-purple-600 hover:bg-purple-700 py-2 px-4 rounded-md text-white font-medium">
                            <i class="fas fa-download mr-2"></i>Export Data
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Genomics Tab -->
        <div id="bioinformatics" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Genomic Summary -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Genomic Overview</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Species Diversity:</span>
                            <span class="font-semibold">{{ genomic_data.species_diversity }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Genetic Variants:</span>
                            <span class="font-semibold">{{ genomic_data.genetic_variants }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Conservation Status:</span>
                            <span class="font-semibold text-emerald-600">{{ genomic_data.conservation_status }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Population Trend:</span>
                            <span class="font-semibold text-emerald-600">{{ genomic_data.population_trend }}</span>
                        </div>
                    </div>
                </div>

                <!-- Analysis Progress -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Analysis Progress</h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm">
                                <span>Sequence Analysis</span>
                                <span>{{ genomic_data.analysis_completion }}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                <div class="bg-emerald-600 h-2 rounded-full" style="width: {{ genomic_data.analysis_completion }}%"></div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <p class="text-2xl font-bold text-blue-600">{{ genomic_data.rare_species_count }}</p>
                                <p class="text-sm text-gray-600">Rare Species</p>
                            </div>
                            <div class="p-3 bg-purple-50 rounded-lg">
                                <p class="text-2xl font-bold text-purple-600">{{ genomic_data.endemic_species }}</p>
                                <p class="text-sm text-gray-600">Endemic Species</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Genomic Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Genetic Diversity</h3>
                    <div class="chart-container">
                        <canvas id="geneticChart"></canvas>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Monthly Samples</h3>
                    <div class="chart-container">
                        <canvas id="samplesChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Gene Expression Heatmap -->
            <div class="mt-6 bg-white p-6 rounded-lg card-shadow">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Gene Expression Heatmap</h3>
                <div id="geneHeatmap" class="grid grid-cols-5 gap-1 max-w-md mx-auto"></div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Statistical Analysis Panel -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-calculator mr-2 text-emerald-600"></i>Statistical Analysis
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Dataset</label>
                            <select id="analysisDataset" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="environmental">Environmental Data</option>
                                <option value="genomic">Genomic Data</option>
                                <option value="biodiversity">Biodiversity Records</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Analysis Type</label>
                            <select id="analysisType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="descriptive">Descriptive Statistics</option>
                                <option value="correlation">Correlation Analysis</option>
                                <option value="ttest">T-Test</option>
                                <option value="anova">ANOVA</option>
                                <option value="regression">Linear Regression</option>
                            </select>
                        </div>
                        
                        <button onclick="runAnalysis()" class="w-full eco-button py-2 px-4 rounded-md text-white font-medium">
                            <i class="fas fa-play mr-2"></i>Run Analysis
                        </button>
                    </div>
                    
                    <!-- Analysis Results -->
                    <div id="analysisResults" class="mt-6 hidden">
                        <h4 class="font-medium text-gray-900 mb-2">Analysis Results</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <pre id="resultsContent" class="text-sm text-gray-700 whitespace-pre-wrap"></pre>
                        </div>
                    </div>
                </div>

                <!-- Visualization Panel -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-chart-bar mr-2 text-blue-600"></i>Data Visualization
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Chart Type</label>
                            <select id="chartType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="scatter">Scatter Plot</option>
                                <option value="histogram">Histogram</option>
                                <option value="boxplot">Box Plot</option>
                                <option value="heatmap">Heatmap</option>
                                <option value="line">Line Chart</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Variables</label>
                            <select id="chartVariables" multiple class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="temperature">Temperature</option>
                                <option value="humidity">Humidity</option>
                                <option value="ph_level">pH Level</option>
                                <option value="oxygen_level">Oxygen Level</option>
                                <option value="species_count">Species Count</option>
                            </select>
                        </div>
                        
                        <button onclick="generateChart()" class="w-full bg-blue-600 hover:bg-blue-700 py-2 px-4 rounded-md text-white font-medium">
                            <i class="fas fa-chart-line mr-2"></i>Generate Chart
                        </button>
                    </div>
                </div>
            </div>

            <!-- Biodiversity Heatmap -->
            <div class="bg-white p-6 rounded-lg card-shadow">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Biodiversity Distribution Heatmap</h3>
                <div id="heatmap-container" class="flex flex-col gap-1 max-w-md mx-auto"></div>
            </div>

            <!-- Generated Charts Container -->
            <div id="generatedCharts" class="mt-6 hidden">
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Generated Visualization</h3>
                    <div id="chartContainer" class="chart-container"></div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Report Generation -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-file-alt mr-2 text-purple-600"></i>Generate Report
                    </h3>
                    
                    <form id="reportForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Report Type</label>
                            <select id="reportType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="comprehensive">Comprehensive Analysis</option>
                                <option value="environmental">Environmental Summary</option>
                                <option value="genomic">Genomic Analysis</option>
                                <option value="biodiversity">Biodiversity Assessment</option>
                                <option value="statistical">Statistical Report</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="date" id="startDate" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                <input type="date" id="endDate" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Output Format</label>
                            <select id="outputFormat" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                <option value="pdf">PDF Report</option>
                                <option value="excel">Excel Workbook</option>
                                <option value="csv">CSV Data</option>
                                <option value="html">HTML Report</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" id="includeCharts" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                                <span class="ml-2 text-sm text-gray-700">Include Charts and Visualizations</span>
                            </label>
                        </div>
                        
                        <button type="button" onclick="generateReport()" class="w-full bg-purple-600 hover:bg-purple-700 py-2 px-4 rounded-md text-white font-medium">
                            <i class="fas fa-file-download mr-2"></i>Generate Report
                        </button>
                    </form>
                </div>

                <!-- Recent Reports -->
                <div class="bg-white p-6 rounded-lg card-shadow">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-history mr-2 text-blue-600"></i>Recent Reports
                    </h3>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-file-pdf text-red-600 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Environmental_Analysis_2024.pdf</p>
                                    <p class="text-xs text-gray-500">Generated 2 hours ago</p>
                                </div>
                            </div>
                            <button class="text-emerald-600 hover:text-emerald-800">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-file-excel text-green-600 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Genomic_Data_Summary.xlsx</p>
                                    <p class="text-xs text-gray-500">Generated 1 day ago</p>
                                </div>
                            </div>
                            <button class="text-emerald-600 hover:text-emerald-800">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                        
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-file-alt text-blue-600 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Biodiversity_Report.html</p>
                                    <p class="text-xs text-gray-500">Generated 3 days ago</p>
                                </div>
                            </div>
                            <button class="text-emerald-600 hover:text-emerald-800">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Templates -->
            <div class="bg-white p-6 rounded-lg card-shadow">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-template mr-2 text-indigo-600"></i>Report Templates
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-emerald-300 hover:bg-emerald-50 transition-colors cursor-pointer">
                        <i class="fas fa-leaf text-emerald-600 text-2xl mb-2"></i>
                        <h4 class="font-medium text-gray-900">Environmental Impact</h4>
                        <p class="text-sm text-gray-500 mt-1">Comprehensive environmental monitoring report with trend analysis</p>
                    </div>
                    
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 hover:bg-blue-50 transition-colors cursor-pointer">
                        <i class="fas fa-dna text-blue-600 text-2xl mb-2"></i>
                        <h4 class="font-medium text-gray-900">Genomic Analysis</h4>
                        <p class="text-sm text-gray-500 mt-1">Detailed genomic diversity and conservation status report</p>
                    </div>
                    
                    <div class="border border-gray-200 rounded-lg p-4 hover:border-purple-300 hover:bg-purple-50 transition-colors cursor-pointer">
                        <i class="fas fa-chart-bar text-purple-600 text-2xl mb-2"></i>
                        <h4 class="font-medium text-gray-900">Statistical Summary</h4>
                        <p class="text-sm text-gray-500 mt-1">Statistical analysis with correlations and significance tests</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart Data Script -->
<script>
    // Make chart data available to JavaScript
    const chartData = {{ chart_data|safe }};
    const heatmapData = {{ heatmap_data|safe }};
</script>

<!-- Dashboard JavaScript -->
<script>
// File Upload Functionality
document.getElementById('uploadForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const progressDiv = document.getElementById('uploadProgress');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    
    // Show progress
    progressDiv.classList.remove('hidden');
    
    // Make actual AJAX request to upload endpoint
    fetch('{% url "upload_data" %}', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            progressBar.style.width = '100%';
            progressText.textContent = data.message;
            setTimeout(() => {
                progressDiv.classList.add('hidden');
                progressBar.style.width = '0%';
                // Refresh the page or update the UI
                location.reload();
            }, 2000);
        } else {
            progressText.textContent = 'Error: ' + data.error;
            progressBar.classList.add('bg-red-600');
        }
    })
    .catch(error => {
        progressText.textContent = 'Upload failed: ' + error.message;
        progressBar.classList.add('bg-red-600');
    });
});

// Statistical Analysis Functions
function runAnalysis() {
    const dataset = document.getElementById('analysisDataset').value;
    const analysisType = document.getElementById('analysisType').value;
    
    // Show loading
    const resultsDiv = document.getElementById('analysisResults');
    const resultsContent = document.getElementById('resultsContent');
    
    resultsDiv.classList.remove('hidden');
    resultsContent.textContent = 'Running analysis...';
    
    // Make AJAX request to analysis endpoint
    fetch('{% url "run_analysis" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            dataset: dataset,
            analysis_type: analysisType
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultsContent.textContent = JSON.stringify(data.results, null, 2);
        } else {
            resultsContent.textContent = 'Error: ' + data.error;
        }
    })
    .catch(error => {
        resultsContent.textContent = 'Analysis failed: ' + error.message;
    });
}

// Chart Generation Functions
function generateChart() {
    const chartType = document.getElementById('chartType').value;
    const variables = Array.from(document.getElementById('chartVariables').selectedOptions).map(option => option.value);
    
    const chartsDiv = document.getElementById('generatedCharts');
    chartsDiv.classList.remove('hidden');
    
    // Make AJAX request to visualization endpoint
    fetch('{% url "generate_visualization" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            chart_type: chartType,
            variables: variables
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Create chart with the returned data
            document.getElementById('chartContainer').innerHTML = `
                <div class="flex items-center justify-center h-64 bg-gray-100 rounded-lg">
                    <div class="text-center">
                        <i class="fas fa-chart-${chartType === 'scatter' ? 'scatter' : 'bar'} text-4xl text-gray-400 mb-2"></i>
                        <p class="text-gray-600">${chartType.charAt(0).toUpperCase() + chartType.slice(1)} chart generated</p>
                        <p class="text-sm text-gray-500">Variables: ${variables.join(', ')}</p>
                    </div>
                </div>
            `;
        } else {
            document.getElementById('chartContainer').innerHTML = `<p class="text-red-600">Error: ${data.error}</p>`;
        }
    })
    .catch(error => {
        document.getElementById('chartContainer').innerHTML = `<p class="text-red-600">Chart generation failed: ${error.message}</p>`;
    });
}

// Report Generation Functions
function generateReport() {
    const reportType = document.getElementById('reportType').value;
    const outputFormat = document.getElementById('outputFormat').value;
    const includeCharts = document.getElementById('includeCharts').checked;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    // Show loading state
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
    button.disabled = true;
    
    // Make AJAX request to report endpoint
    fetch('{% url "generate_report" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            report_type: reportType,
            output_format: outputFormat,
            include_charts: includeCharts,
            start_date: startDate,
            end_date: endDate
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            // You could also trigger a download here
        } else {
            alert('Error: ' + data.error);
        }
        button.innerHTML = originalText;
        button.disabled = false;
    })
    .catch(error => {
        alert('Report generation failed: ' + error.message);
        button.innerHTML = originalText;
        button.disabled = false;
    });
}

// Utility Functions
function runStatisticalAnalysis(dataType) {
    alert(`Running statistical analysis for ${dataType} data...`);
}

function generateVisualization(dataType) {
    alert(`Generating visualizations for ${dataType} data...`);
}

function exportData(dataType) {
    alert(`Exporting ${dataType} data...`);
}
</script>
{% endblock %}